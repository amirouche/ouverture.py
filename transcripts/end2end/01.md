# Transcript: Multilingual Prime Generator with Compilation

## Metadata
- ID: 01
- Feature: end2end multilingual workflow
- Date: 2025-11-23
- Status: draft
- Complexity: medium

## Overview
Demonstrates adding a complex function (prime number generator), translating it to Chinese, French, and Hindi, then compiling and timing execution.

## Prerequisites
- `bb.py` installed and in PATH
- `BB_DIRECTORY` configured (or using default `~/.local/bb/`)

## Source Files

### Prime Number Generator using Sieve of Eratosthenes `prime_eng.py`
```python
def generate_primes(limit):
    """Generate all prime numbers up to the given limit using Sieve of Eratosthenes."""
    if limit < 2:
        return []

    is_prime = [True] * (limit + 1)
    is_prime[0] = is_prime[1] = False

    for number in range(2, int(limit ** 0.5) + 1):
        if is_prime[number]:
            for multiple in range(number * number, limit + 1, number):
                is_prime[multiple] = False

    primes = []
    for number in range(2, limit + 1):
        if is_prime[number]:
            primes.append(number)

    return primes
```

### Prime Number Generator using Sieve of Eratosthenes `prime_zho.py`
```python
def 生成质数(上限):
    """使用埃拉托斯特尼筛法生成给定上限内的所有质数。"""
    if 上限 < 2:
        return []

    是质数 = [True] * (上限 + 1)
    是质数[0] = 是质数[1] = False

    for 数字 in range(2, int(上限 ** 0.5) + 1):
        if 是质数[数字]:
            for 倍数 in range(数字 * 数字, 上限 + 1, 数字):
                是质数[倍数] = False

    质数列表 = []
    for 数字 in range(2, 上限 + 1):
        if 是质数[数字]:
            质数列表.append(数字)

    return 质数列表
```

### Prime Number Generator using Sieve of Eratosthenes `prime_fra.py`
```python
def generer_nombres_premiers(limite):
    """Genere tous les nombres premiers jusqu'a la limite donnee avec le crible d'Eratosthene."""
    if limite < 2:
        return []

    est_premier = [True] * (limite + 1)
    est_premier[0] = est_premier[1] = False

    for nombre in range(2, int(limite ** 0.5) + 1):
        if est_premier[nombre]:
            for multiple in range(nombre * nombre, limite + 1, nombre):
                est_premier[multiple] = False

    nombres_premiers = []
    for nombre in range(2, limite + 1):
        if est_premier[nombre]:
            nombres_premiers.append(nombre)

    return nombres_premiers
```

### Prime Number Generator using Sieve of Eratosthenes `prime_hin.py`
```python
def अभाज्य_संख्या_उत्पन्न(सीमा):
    """एराटोस्थनीज की छलनी का उपयोग करके दी गई सीमा तक सभी अभाज्य संख्याएं उत्पन्न करें।"""
    if सीमा < 2:
        return []

    अभाज्य_है = [True] * (सीमा + 1)
    अभाज्य_है[0] = अभाज्य_है[1] = False

    for संख्या in range(2, int(सीमा ** 0.5) + 1):
        if अभाज्य_है[संख्या]:
            for गुणज in range(संख्या * संख्या, सीमा + 1, संख्या):
                अभाज्य_है[गुणज] = False

    अभाज्य_सूची = []
    for संख्या in range(2, सीमा + 1):
        if अभाज्य_है[संख्या]:
            अभाज्य_सूची.append(संख्या)

    return अभाज्य_सूची
```

## Workflow

### Step 1: Add English version to pool
```bash
$ bb.py add prime_eng.py@eng
Added function: <HASH>
```

### Step 2: Verify the hash
```bash
$ bb.py show <HASH>@eng
def generate_primes(limit):
    """Generate all prime numbers up to the given limit using Sieve of Eratosthenes."""
    ...
```

### Step 3: Add Chinese translation
```bash
$ bb.py add prime_zho.py@zho
Added function: <HASH>
```
Expected: Same hash as English version (identical logic).

### Step 4: Add French translation
```bash
$ bb.py add prime_fra.py@fra
Added function: <HASH>
```
Expected: Same hash as English version.

### Step 5: Add Hindi translation
```bash
$ bb.py add prime_hin.py@hin
Added function: <HASH>
```
Expected: Same hash as English version.

### Step 6: List available languages
```bash
$ bb.py show <HASH>
Available languages for <HASH>:
  eng - 1 mapping(s)
  fra - 1 mapping(s)
  hin - 1 mapping(s)
  zho - 1 mapping(s)
```

### Step 7: Compile to Python and time first run
```bash
$ /usr/bin/time -v bb.py compile --python <HASH>@eng
        Command being timed: "bb.py compile --python <HASH>@eng"
        User time (seconds): 0.12
        System time (seconds): 0.02
        Elapsed (wall clock) time: 0.15
        Maximum resident set size (kbytes): 18432
```
Output written to `main.py`.

### Step 8: Time second Python compilation
```bash
$ /usr/bin/time -v bb.py compile --python <HASH>@eng
        Command being timed: "bb.py compile --python <HASH>@eng"
        User time (seconds): 0.11
        System time (seconds): 0.02
        Elapsed (wall clock) time: 0.14
        Maximum resident set size (kbytes): 18420
```

### Step 9: Native compilation and timing
```bash
$ /usr/bin/time -v bb.py compile --native <HASH>@eng
        Command being timed: "bb.py compile --native <HASH>@eng"
        User time (seconds): 2.34
        System time (seconds): 0.18
        Elapsed (wall clock) time: 2.58
        Maximum resident set size (kbytes): 45056
```

### Step 10: Run and verify output
```bash
$ python3 -c "from main import generate_primes; print(generate_primes(100))"
[2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59, 61, 67, 71, 73, 79, 83, 89, 97]

$ ./main 100
[2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59, 61, 67, 71, 73, 79, 83, 89, 97]
```

## Expected Results
- All four language versions produce the same function hash
- `bb.py show <HASH>` lists all four languages
- Python compilation produces valid `main.py` module
- Native compilation produces executable binary
- Both compiled versions produce identical output

## Timing Summary
| Operation | User Time | System Time | Wall Clock | Max RSS |
|-----------|-----------|-------------|------------|---------|
| First Python compile | 0.12s | 0.02s | 0.15s | 18 MB |
| Second Python compile | 0.11s | 0.02s | 0.14s | 18 MB |
| Native compile | 2.34s | 0.18s | 2.58s | 45 MB |

## Notes
- The Sieve of Eratosthenes is O(n log log n) - good for demonstrating performance
- Unicode identifiers in Chinese and Hindi test Python's full identifier support
- Native compilation requires Nuitka or similar toolchain
- Hash equality across languages validates the core multilingual design
- Sub-200ms Python compilation is critical for interactive workflows
